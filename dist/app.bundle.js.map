{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"react\"","webpack:///external \"express\"","webpack:///external \"mongodb\"","webpack:///./server/server.js","webpack:///./server/renderedPageRouter.jsx","webpack:///external \"react-dom/server\"","webpack:///external \"react-router\"","webpack:///./server/template.js","webpack:///./src/HelloWorld.jsx","webpack:///external \"body-parser\"","webpack:///external \"os\"","webpack:///external \"path\"","webpack:///./server/issue.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","_renderedPageRouter","express","bodyParser","MongoClient","mn","Issue","app","use","static","json","req","res","filter","query","status","effort_lte","effort_gte","effort","$lte","parseInt","$gte","search","$text","$search","undefined","_summary","offset","_offset","limit","_limit","cursor","dbo","collection","find","sort","_id","skip","totalCount","count","then","result","toArray","issues","console","log","metadata","records","catch","error","message","aggregate","$match","$group","owner","$sum","results","stats","forEach","issueId","ObjectId","params","id","next","issue","post","newIssue","body","created","Date","insertOne","insertedId","err","put","validateIssue","convertIssue","update","savedIssue","delete","deleteOne","deleteResult","renderedPageRouter","connect","db","listen","_server","Router","initialState","addressee","html","renderToString","_react2","default","createElement","_HelloWorld2","send","_template2","JSON","stringify","_react","HelloWorld","props","_classCallCheck","this","_this","_possibleConstructorReturn","__proto__","getPrototypeOf","state","assign","React","Component","_this2","setTimeout","setState","defaultProps","validIssueStatus","New","Open","Assigned","Fixed","Verified","Closed","issueFieldType","completionDate","title","cleanupIssue","cleanedUpIssue","keys","field","errors","push","length","join"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","module.exports = require(\"react\");","module.exports = require(\"express\");","module.exports = require(\"mongodb\");","const express = require(\"express\");\r\nconst bodyParser = require('body-parser');\r\nconst os = require(\"os\");\r\nconst MongoClient = require('mongodb').MongoClient;\r\nconst path = require('path');\r\nconst mn = require('mongodb');\r\nconst Issue = require('./issue.js');\r\n\r\nconst app = express();\r\napp.use(express.static('../statics'));\r\napp.use(express.static('../node_modules/bootstrap/dist/css/'));\r\napp.use(bodyParser.json());\r\n\r\nimport renderedPageRouter from './renderedPageRouter.jsx';\r\n\r\n// app.get('/api/issues', (req, res) => {\r\n//     console.log(\"服务器收到请求。\")\r\n//     const filter = {};\r\n//     if (req.query.status) filter.status = req.query.status;\r\n//     if (req.query.effort_lte || req.query.effort_gte) filter.effort = {};\r\n//     if (req.query.effort_lte) filter.effort.$lte = parseInt(req.query.effort_lte, 10);\r\n//     if (req.query.effort_gte) filter.effort.$gte = parseInt(req.query.effort_gte, 10);\r\n//     console.log(filter);\r\n//     dbo.collection('issues').find(filter).toArray().then(issues => {\r\n//         const metadata = { total_count: issues.length };\r\n//         res.json({ _metadata: metadata, records: issues });\r\n//     }).catch(error => {\r\n//         console.log(error);\r\n//         res.status(500).json({ message: `internal server error: ${error}` });\r\n//     })\r\n// });\r\n\r\napp.get('/api/issues', (req, res) => {\r\n    const filter = {};\r\n    if (req.query.status) filter.status = req.query.status;\r\n    if (req.query.effort_lte || req.query.effort_gte) filter.effort = {};\r\n    if (req.query.effort_lte) filter.effort.$lte = parseInt(req.query.effort_lte, 10);\r\n    if (req.query.effort_gte) filter.effort.$gte = parseInt(req.query.effort_gte, 10);\r\n    if (req.query.search) filter.$text = { $search: req.query.search };\r\n\r\n    if (req.query._summary === undefined) {\r\n        const offset = req.query._offset ? parseInt(req.query._offset, 10) : 0;\r\n        let limit = req.query._limit ? parseInt(req.query._limit, 10) : 20;\r\n        if (limit > 50) limit = 50;\r\n\r\n        const cursor = dbo.collection('issues').find(filter).sort({ _id: 1 })\r\n            .skip(offset)\r\n            .limit(limit);\r\n\r\n        let totalCount;\r\n        cursor.count(false).then(result => {\r\n            totalCount = result;\r\n            return cursor.toArray();\r\n        })\r\n            .then(issues => {\r\n                console.log(\"查询出的数据： \", issues);\r\n                res.json({ metadata: { totalCount }, records: issues });\r\n            })\r\n            .catch(error => {\r\n                console.log(error);\r\n                res.status(500).json({ message: `Internal Server Error: ${error}` });\r\n            });\r\n    } else {\r\n        dbo.collection('issues').aggregate([\r\n            { $match: filter },\r\n            { $group: { _id: { owner: '$owner', status: '$status' }, count: { $sum: 1 } } },\r\n        ]).toArray()\r\n            .then(results => {\r\n                const stats = {};\r\n                results.forEach(result => {\r\n                    if (!stats[result._id.owner]) stats[result._id.owner] = {};\r\n                    stats[result._id.owner][result._id.status] = result.count;\r\n                });\r\n                res.json(stats);\r\n            })\r\n            .catch(error => {\r\n                console.log(error);\r\n                res.status(500).json({ message: `Internal Server Error: ${error}` });\r\n            });\r\n    }\r\n});\r\n\r\napp.get('/api/issues/:id', (req, res) => {\r\n    let issueId;\r\n    try {\r\n        issueId = mn.ObjectId(req.params.id);\r\n    } catch (error) {\r\n        res.status(422).json({ message: `Invalid issue ID : ${error}` });\r\n    }\r\n\r\n    dbo.collection('issues').find({ _id: issueId }).limit(1).next()\r\n        .then(issue => {\r\n            if (!issue) res.status(404).json({ message: `No such issue: ${issueId}` });\r\n            else res.json(issue);\r\n        })\r\n        .catch(error => {\r\n            console.log(error);\r\n            res.status(500).json({ message: `Invalid server: ${error}` })\r\n        })\r\n})\r\n\r\napp.post('/api/issues', (req, res) => {\r\n    const newIssue = req.body;\r\n    // newIssue.id = issues.length + 1;\r\n    newIssue.created = new Date();\r\n    if (!newIssue.status) {\r\n        newIssue.status = 'New';\r\n    }\r\n    dbo.collection('issues').insertOne(newIssue).then(result =>\r\n        dbo.collection('issues').find({ _id: result.insertedId }).limit(1).next()\r\n    ).then(newIssue => {\r\n        console.log(\"添加的数据是： \", newIssue);\r\n        res.json(newIssue);\r\n    }).catch(err => {\r\n        console.log(err);\r\n    });\r\n})\r\n\r\napp.put('/api/issues/:id', (req, res) => {\r\n    let issueId;\r\n    try {\r\n        issueId = mn.ObjectId(req.params.id);\r\n    } catch (error) {\r\n        res.status(422).json({ message: `Invalid issue ID format: ${error}` });\r\n        return;\r\n    }\r\n\r\n    const issue = req.body;\r\n    delete issue._id;\r\n\r\n    const err = Issue.validateIssue(issue);\r\n    if (err) {\r\n        res.status(422).json({ message: `Invalid request: ${err}` });\r\n        return;\r\n    }\r\n    console.log(\"Update immed...\");\r\n    console.log(Issue.convertIssue(issue));\r\n    dbo.collection('issues').update({ _id: issueId }, Issue.convertIssue(issue)).then(result =>\r\n        // console.log(\"Update success...\");\r\n        // console.log(result);\r\n        dbo.collection('issues').find({ _id: issueId }).limit(1).next()\r\n    ).then(savedIssue => {\r\n        console.log(\"保存的东西： \", savedIssue);\r\n        res.json(savedIssue);\r\n    }).catch(error => {\r\n        console.log(error);\r\n        res.status(500).json({ message: `Internal Server Error: ${error}` });\r\n    });\r\n});\r\n\r\napp.delete('/api/issues/:id', (req, res) => {\r\n    console.log(\"server will delete...\");\r\n    console.log(\"delete id is: \", req.params.id);\r\n    let issueId;\r\n    try {\r\n        issueId = mn.ObjectId(req.params.id);\r\n        console.log(\"now delete data...\", issueId);\r\n    } catch (error) {\r\n        res.status(422).json({ message: `Invalid issue ID format: ${error}` });\r\n        return;\r\n    }\r\n\r\n    dbo.collection('issues').deleteOne({ _id: issueId }).then((deleteResult) => {\r\n        if (deleteResult.result.n === 1) res.json({ status: 'OK' });\r\n        else res.json({ status: 'Warning: object not found' });\r\n    })\r\n        .catch(error => {\r\n            console.log(error);\r\n            res.status(500).json({ message: `Internal Server Error: ${error}` });\r\n        });\r\n});\r\n\r\n// app.get('*', (req, res) => {\r\n//     // res.send('success');\r\n//     res.sendFile(path.resolve('../statics/index.html'));\r\n// })\r\n\r\napp.use('/', renderedPageRouter);\r\n\r\nlet dbo;\r\nMongoClient.connect('mongodb://127.0.0.1:27017/').then(db => {\r\n    dbo = db.db('issuetracker');\r\n    app.listen(3000, () => {\r\n        console.log('App started on port 3000');\r\n    });\r\n}).catch(error => {\r\n    console.log('ERROR:', error);\r\n});","import React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { match, RouterContext } from 'react-router';\r\n\r\nimport Router from 'express';\r\n\r\nimport template from './template.js';\r\nimport HelloWorld from '../src/HelloWorld.jsx';\r\n\r\nconst renderedPageRouter = new Router();\r\n\r\nrenderedPageRouter.get('*', (req, res) => {\r\n    const initialState = { addressee: 'Unisd3333333' };\r\n    const html = renderToString(<HelloWorld {...initialState} />);\r\n    res.send(template(html, initialState));\r\n});\r\n\r\nexport default renderedPageRouter;","module.exports = require(\"react-dom/server\");","module.exports = require(\"react-router\");","export default function template(body, initialState) {\r\n    return `<!DOCTYPE HTML>\r\n  <html>\r\n  <head>\r\n    <meta charset=\"UTF-8\" />\r\n    <title>Pro MERN Stack</title>\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <link rel=\"stylesheet\" href=\"/bootstrap.min.css\" >\r\n    <link rel=\"stylesheet\" href=\"/react-select/react-select.css\" >\r\n    <style>\r\n      .panel-title a {display: block; width: 100%; cursor: pointer; }\r\n    </style>\r\n  </head>\r\n  \r\n  <body>\r\n    <div id=\"contents\">${body}</div>    <!-- this is where our component will appear -->\r\n    <script>window.__INITIAL_STATE__ = ${JSON.stringify(initialState)};</script>\r\n    <script src=\"/vendor.js\"></script>\r\n    <script src=\"/app.js\"></script>\r\n    <script src=\"/config.js\"></script>\r\n  </body>\r\n  \r\n  </html>\r\n  `;\r\n}","import React from 'react';\r\n\r\nexport default class HelloWorld extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = Object.assign({}, this.props);\r\n    }\r\n\r\n    componentDidMount() {\r\n        setTimeout(() => {\r\n            console.log(\"有反应···\");\r\n            this.setState({ addressee: 'Universes' });\r\n        }, 3000);\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <h1>Hello {this.state.addressee}!</h1>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\n\r\nHelloWorld.defaultProps = {\r\n    addressee: '',\r\n};","module.exports = require(\"body-parser\");","module.exports = require(\"os\");","module.exports = require(\"path\");","const validIssueStatus = {\r\n    New: true,\r\n    Open: true,\r\n    Assigned: true,\r\n    Fixed: true,\r\n    Verified: true,\r\n    Closed: true,\r\n};\r\n\r\nconst issueFieldType = {\r\n    status: 'required',\r\n    owner: 'required',\r\n    effort: 'optional',\r\n    created: 'required',\r\n    completionDate: 'optional',\r\n    title: 'required',\r\n};\r\n\r\nfunction cleanupIssue(issue) {\r\n    const cleanedUpIssue = {};\r\n    Object.keys(issue).forEach(field => {\r\n        if (issueFieldType[field]) cleanedUpIssue[field] = issue[field];\r\n    });\r\n    return cleanedUpIssue;\r\n}\r\n\r\nfunction convertIssue(issue) {\r\n    if (issue.created) issue.created = new Date(issue.created);\r\n    if (issue.completionDate) issue.completionDate = new Date(issue.completionDate);\r\n    return cleanupIssue(issue);\r\n}\r\n\r\nfunction validateIssue(issue) {\r\n    const errors = [];\r\n    Object.keys(issueFieldType).forEach(field => {\r\n        if (issueFieldType[field] === 'required' && !issue[field]) {\r\n            errors.push(`Missing mandatory field: ${field}`);\r\n        }\r\n    });\r\n\r\n    if (!validIssueStatus[issue.status]) {\r\n        errors.push(`${issue.status} is not a valid status.`);\r\n    }\r\n\r\n    return (errors.length ? errors.join('; ') : null);\r\n}\r\n\r\nmodule.exports = {\r\n    convertIssue: convertIssue,\r\n    validateIssue: validateIssue,\r\n    cleanupIssue: cleanupIssue,\r\n}"],"sourceRoot":""}