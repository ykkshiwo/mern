{"version":3,"sources":["webpack:///./server/renderedPageRouter.jsx"],"names":["__webpack_require__","_server","_reactRouter","renderedPageRouter","Router","get","req","res","console","log","match","routes","location","url","error","redirectLocation","renderProps","status","send","message","redirect","pathname","search","dataFetchers","components","filter","c","dataFetcher","map","params","urlBase","cookie","headers","Promise","all","then","dataList","initialState","forEach","namedData","Object","assign","html","renderToString","_react2","default","createElement","_ContextWrapper2","RouterContext","_template2","catch","err"],"mappings":"+GAAA,QAAAA,EAAA,IACAC,EAAAD,EAAA,IACAE,EAAAF,EAAA,QAEAA,EAAA,QAEAA,EAAA,SACAA,EAAA,SACAA,EAAA,wDAEA,IAAMG,EAAqB,IAAIC,UAE/BD,EAAmBE,IAAI,IAAK,SAACC,EAAKC,GAChCC,QAAQC,IAAI,YACZ,EAAAP,EAAAQ,OAAM,CAAEC,iBAAQC,SAAUN,EAAIO,KAAO,SAACC,EAAOC,EAAkBC,GAC7D,GAAIF,EACFP,EAAIU,OAAO,KAAKC,KAAKJ,EAAMK,cACtB,GAAIJ,EACTR,EAAIa,SAAS,IAAKL,EAAiBM,SAAWN,EAAiBO,aAC1D,GAAIN,EAAa,CACtB,IACMO,EADqBP,EAAYQ,WAAWC,OAAO,SAAAC,GAAA,OAAKA,EAAEC,cACxBC,IAAI,SAAAF,GAAA,OAAKA,EAAEC,YAAY,CAC7DE,OAAQb,EAAYa,OAAQjB,SAAUI,EAAYJ,SAClDkB,QAAS,wBAAyBC,OAAQzB,EAAI0B,QAAQD,WAExDE,QAAQC,IAAIX,GAAcY,KAAK,SAACC,GAC9B,IAAIC,EAAe,GACnBD,EAASE,QAAQ,SAACC,GAChBF,EAAeG,OAAOC,OAAOJ,EAAcE,KAE7C,IAAMG,GAAO,EAAAzC,EAAA0C,gBACXC,EAAAC,QAAAC,cAACC,EAAAF,QAAD,CAAgBR,aAAcA,GAC5BO,EAAAC,QAAAC,cAAC5C,EAAA8C,cAAkBhC,KAGvBT,EAAIU,OAAO,KAAKC,MAAK,EAAA+B,EAAAJ,SAASH,EAAML,MAErCa,MAAM,SAAAC,GACL3C,QAAQC,IAAR,8BAA0C0C,UAG5C5C,EAAIU,OAAO,KAAKC,KAAK,2BAKZf","file":"0.520f9f47778f5c49c038.hot-update.js","sourcesContent":["import React from 'react';\r\nimport { renderToString } from 'react-dom/server';\r\nimport { match, RouterContext } from 'react-router';\r\n\r\nimport Router from 'express';\r\n\r\nimport template from './template.js';\r\nimport routes from '../src/Routes.jsx';\r\nimport ContextWrapper from '../src/ContextWrapper.jsx';\r\n \r\nconst renderedPageRouter = new Router();\r\n\r\nrenderedPageRouter.get('*', (req, res) => {\r\n  console.log(\"服务器启用成功\");\r\n  match({ routes, location: req.url }, (error, redirectLocation, renderProps) => {\r\n    if (error) {\r\n      res.status(500).send(error.message);\r\n    } else if (redirectLocation) {\r\n      res.redirect(302, redirectLocation.pathname + redirectLocation.search);\r\n    } else if (renderProps) {\r\n      const componentsWithData = renderProps.components.filter(c => c.dataFetcher);\r\n      const dataFetchers = componentsWithData.map(c => c.dataFetcher({\r\n        params: renderProps.params, location: renderProps.location,\r\n        urlBase: 'http://localhost:3000', cookie: req.headers.cookie,\r\n      }));\r\n      Promise.all(dataFetchers).then((dataList) => {\r\n        let initialState = {};\r\n        dataList.forEach((namedData) => {\r\n          initialState = Object.assign(initialState, namedData);\r\n        });\r\n        const html = renderToString(\r\n          <ContextWrapper initialState={initialState} >\r\n            <RouterContext {...renderProps} />\r\n          </ContextWrapper>\r\n        );\r\n        res.status(200).send(template(html, initialState));\r\n      })\r\n      .catch(err => {\r\n        console.log(`Error rendering to string: ${err}`);\r\n      });\r\n    } else {\r\n      res.status(404).send('Not found');\r\n    }\r\n  });\r\n});\r\n\r\nexport default renderedPageRouter;\r\n"],"sourceRoot":""}